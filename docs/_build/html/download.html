

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Downloading data &mdash; ukb_download_and_prep_template 0.0-0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Advanced usage" href="advanced.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> ukb_download_and_prep_template
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="core.html">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced usage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Downloading data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#downloading-participant-data">Downloading participant data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#extracting-participant-data-to-csv">Extracting participant data to <code class="code docutils literal notranslate"><span class="pre">.csv</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#steps">Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#downloading-health-data">Downloading health data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Steps</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ukb_download_and_prep_template</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Downloading data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/download.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="downloading-data">
<h1>Downloading data<a class="headerlink" href="#downloading-data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="downloading-participant-data">
<h2>Downloading participant data<a class="headerlink" href="#downloading-participant-data" title="Permalink to this headline">¶</a></h2>
<p>Here we are using only standard UK Biobank functionality, so <a class="reference external" href="https://biobank.ctsu.ox.ac.uk/~bbdatan/Accessing_UKB_data_v2.1.pdf">UK Biobank’s guide to accessing the data</a> is a very useful reference.</p>
<p>You will have initially downloaded an encrypted <code class="code docutils literal notranslate"><span class="pre">ukb12345.enc</span></code> file. This needs to be decrypted using the key provided by UK Biobank in an email e.g. for research application 6789 and copy number 12345 we would decrypt to an ‘unpacked’ file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">download</span><span class="o">/</span><span class="n">helpers</span><span class="o">/</span><span class="n">linux_tools</span><span class="o">/</span><span class="n">ukb_unpack</span> <span class="n">path_to_data</span><span class="o">/</span><span class="n">ukb12345</span><span class="o">.</span><span class="n">enc</span> <span class="n">k6789r12345</span><span class="o">.</span><span class="n">key</span>
<span class="n">download</span><span class="o">/</span><span class="n">helpers</span><span class="o">/</span><span class="n">linux_tools</span><span class="o">/</span><span class="n">ukb_unpack</span> <span class="n">path_to_data</span><span class="o">/</span><span class="n">ukb12345</span><span class="o">.</span><span class="n">enc</span> <span class="n">k6789r12345</span><span class="o">.</span><span class="n">key</span>
<span class="c1"># output = path_to_data/ukb12345.enc_ukb</span>
</pre></div>
</div>
<p>To extract data from this to <code class="code docutils literal notranslate"><span class="pre">.csv</span></code> format, see the <a class="reference external" href="https://ukb-download-and-prep-template.readthedocs.io/en/latest/extract.html">next section</a>.</p>
</div>
<div class="section" id="extracting-participant-data-to-csv">
<h2>Extracting participant data to <code class="code docutils literal notranslate"><span class="pre">.csv</span></code><a class="headerlink" href="#extracting-participant-data-to-csv" title="Permalink to this headline">¶</a></h2>
<p>To access a particular set of variables in <code class="code docutils literal notranslate"><span class="pre">.csv</span></code> format, we extract them from the <code class="code docutils literal notranslate"><span class="pre">12345.enc_ukb</span></code> file (which contains all variables in the application).</p>
<div class="section" id="steps">
<h3>Steps<a class="headerlink" href="#steps" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Find the <a class="reference external" href="http://biobank.ctsu.ox.ac.uk/crystal/search.cgi">UK Biobank Data Field IDs</a> of interest (e.g. <a class="reference external" href="http://biobank.ndph.ox.ac.uk/showcase/field.cgi?id=20116">smoking status is 20116</a>).</p></li>
<li><p>If it is not already there, append this field to the file <code class="code docutils literal notranslate"><span class="pre">analysisCols.txt</span></code></p></li>
<li><p>Extract data to <code class="code docutils literal notranslate"><span class="pre">.csv</span></code> format:</p></li>
</ol>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>download/helpers/linux_tools/ukb_conv path_to_data/ukb12345.enc_ukb csv -ianalysisCols.txt
* <span class="nv">output</span> <span class="o">=</span> path_to_data/ukb12345.csv
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="notes">
<h3>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>These steps can be done in Windows, Linux or MacOS, but the helper files you need will be slightly different (the tools are in <code class="code docutils literal notranslate"><span class="pre">download/helpers/linux_tools</span></code> for Linux/MacOS and <code class="code docutils literal notranslate"><span class="pre">download/helpers/windows_tools</span></code> for Windows).</p></li>
<li><p>This may fail initially because <code class="code docutils literal notranslate"><span class="pre">analysisCols.txt</span></code> contains a field ID which is not present in the copy of the dataset you are working with. These field IDs should be removed from <code class="code docutils literal notranslate"><span class="pre">analysisCols.txt</span></code>.</p></li>
<li><p>How long this extraction will take depends on the number of columns you are extracting, but it is not unusual for it to take several hours. If you just want to add a couple of columns, it is quicker to list them in a separate file (e.g. <code class="code docutils literal notranslate"><span class="pre">analysisColsMini.txt</span></code>), extract a small <code class="code docutils literal notranslate"><span class="pre">.csv</span></code> file and merge with the existing file on participant IDs.</p></li>
</ul>
</div>
</div>
<div class="section" id="downloading-health-data">
<h2>Downloading health data<a class="headerlink" href="#downloading-health-data" title="Permalink to this headline">¶</a></h2>
<p>UK Biobank benefits from passive follow-up via health record linkage.</p>
<p>To understand the available datasets:
- Here is <a class="reference external" href="http://biobank.ndph.ox.ac.uk/showcase/showcase/docs/HealthOutcomesOverview.pdf">a good summary of what health outcomes data exists and pros and cons of using different aspects</a> (up-to-date as of Sep 2019).
- Note the <a class="reference external" href="https://biobank.ctsu.ox.ac.uk/crystal/exinfo.cgi?src=Data_providers_and_dates">dates for which HES data are available</a>.</p>
<p>Here, we discuss Hospital Episode Statistics: <a class="reference external" href="https://www.who.int/classifications/icd/icdonlineversions/en/">ICD9/10 codes</a> from hospital admissions. If you require Operations and Procedures codes or primary care codes, these need to be processed separately.</p>
<div class="section" id="id1">
<h3>Steps<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Follow the <a class="reference external" href="http://biobank.ctsu.ox.ac.uk/~bbdatan/Accessing_UKB_data_v2.1.pdf">UKB guide to access the data portal</a>.</p></li>
<li><dl>
<dt>It is easiest to download the whole table for the relevant data type (e.g. hesin is required for using all the others, hesin_diag provides diagnosis codes, hesin_oper operation codes).</dt><dd><ul class="simple">
<li><p>You can do this by putting the name of the data table in the box provided in the Table Download tab.</p></li>
<li><p>If you wish to use the data portal, these SQL statements will download all diagnosis codes from <code class="code docutils literal notranslate"><span class="pre">hesin_diag</span></code> and hospital episode information from <code class="code docutils literal notranslate"><span class="pre">hesin:</span></code></p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">eid</span><span class="p">,</span> <span class="n">ins_index</span><span class="p">,</span> <span class="n">admidate</span><span class="p">,</span> <span class="n">disdate</span><span class="p">,</span> <span class="n">epiend</span><span class="p">,</span> <span class="n">epistart</span> <span class="k">FROM</span> <span class="n">hesin</span> <span class="o">*</span> <span class="k">then</span> <span class="n">click</span> <span class="s1">&#39;Download&#39;</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">hesin_diag</span> <span class="o">*</span> <span class="n">click</span> <span class="s1">&#39;Download&#39;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p>Join files together in preparation for future use.</p>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rename files if necessary to match the names used here</span>
<span class="c1"># Call python script to merge files together and delete downloaded input files</span>
python mergeHESfiles.py ~/Downloads/ukb.txt ~/Downloads/ukb_diag.txt <span class="se">\</span>
~/Downloads/hesin_all.csv
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="advanced.html" class="btn btn-neutral float-left" title="Advanced usage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Rosemary Walmsley, Shing Chan, Aiden Doherty

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>