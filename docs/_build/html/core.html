

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Basic usage &mdash; ukb_download_and_prep_template 0.0-0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Advanced usage" href="advanced.html" />
    <link rel="prev" title="Getting started" href="started.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> ukb_download_and_prep_template
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="started.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Basic usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#relabelling-and-recoding-participant-data">Relabelling and recoding participant data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#steps">Steps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#adding-hospital-episode-statistics">Adding Hospital Episode Statistics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#notes">Notes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="download.html">Downloading data</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ukb_download_and_prep_template</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Basic usage</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/core.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="basic-usage">
<h1>Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="relabelling-and-recoding-participant-data">
<h2>Relabelling and recoding participant data<a class="headerlink" href="#relabelling-and-recoding-participant-data" title="Permalink to this headline">¶</a></h2>
<p>You should have an extracted <code class="code docutils literal notranslate"><span class="pre">ukb12345.csv</span></code> file (extracted from <code class="code docutils literal notranslate"><span class="pre">.enc_ukb</span></code> file) to work with (if not, see <a class="reference external" href="https://ukb-download-and-prep-template.readthedocs.io/en/latest/download.html">this section</a>). It should look something like this:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>eid</p></th>
<th class="head"><p>31-0.0</p></th>
<th class="head"><p>34-0.0</p></th>
<th class="head"><p>54-0.0</p></th>
<th class="head"><p>…</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>4987419</p></td>
<td><p>0</p></td>
<td><p>1944</p></td>
<td><p>11016</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-odd"><td><p>2898413</p></td>
<td><p>0</p></td>
<td><p>1956</p></td>
<td><p>11009</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-even"><td><p>1049655</p></td>
<td><p>1</p></td>
<td><p>1947</p></td>
<td><p>11010</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-odd"><td><p>1892589</p></td>
<td><p>1</p></td>
<td><p>1941</p></td>
<td><p>11011</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-even"><td><p>2449164</p></td>
<td><p>1</p></td>
<td><p>1958</p></td>
<td><p>11010</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
<p>(This is fake data - Any resemblance to real UK Biobank participants is coincidental!)</p>
<ul class="simple">
<li><p>The column names are given as field IDs, and you would need to browse <a class="reference external" href="https://biobank.ndph.ox.ac.uk/showcase/search.cgi">https://biobank.ndph.ox.ac.uk/showcase/search.cgi</a> to get their meanings. For example, <code class="code docutils literal notranslate"><span class="pre">31-0.0</span></code> is sex, <code class="code docutils literal notranslate"><span class="pre">34-0.0</span></code> is year of birth, and <code class="code docutils literal notranslate"><span class="pre">54-0.0</span></code> is assessment center.</p></li>
<li><p>If a field is categorical then its categories are coded e.g. in sex <code class="code docutils literal notranslate"><span class="pre">0</span></code> means female and <code class="code docutils literal notranslate"><span class="pre">1</span></code> means male, and in assessment center <code class="code docutils literal notranslate"><span class="pre">11010</span></code> is Leeds and <code class="code docutils literal notranslate"><span class="pre">11009</span></code> is Newcastle.</p></li>
<li><p>You may have hundreds or thousands of these columns.</p></li>
</ul>
<p>Therefore, the next step towards having ready-to-use data is to filter out some columns and parse the field IDs and categorical codes. (While this can be done manually, the automated tools in this repo aim to make it quicker and easier.)</p>
<div class="section" id="steps">
<h3>Steps<a class="headerlink" href="#steps" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Auto-generate a <code class="code docutils literal notranslate"><span class="pre">columns.json</span></code> file from the text file of field IDs (in the format used in <code class="code docutils literal notranslate"><span class="pre">download_participant_data</span></code>):</p>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python writeColumnsFile.py --columnsFile analysisCols.txt
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Run:</p>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python filterUKB.py ukb12345.csv -o outputFilename.csv
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>If you want to customise the behaviour or add subsequent columns manually, see <a class="reference external" href="https://ukb-download-and-prep-template.readthedocs.io/en/latest/advanced.html">the Advanced Usage options</a></p>
</div>
</div>
<div class="section" id="adding-hospital-episode-statistics">
<h2>Adding Hospital Episode Statistics<a class="headerlink" href="#adding-hospital-episode-statistics" title="Permalink to this headline">¶</a></h2>
<p>In this section we will add columns on disease diagnoses in hospital to an existing participant dataset (<code class="code docutils literal notranslate"><span class="pre">input.csv</span></code>).
You will need:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">hesin_all.csv</span></code>: a file containing Hospital Episode Statistics data for all participants (see <a class="reference external" href="https://ukb-download-and-prep-template.readthedocs.io/en/latest/health.html">here</a>).</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">icdGroups.json</span></code>: a JSON file describing required HES codes (here’s an <a class="reference external" href="https://github.com/activityMonitoring/ukb_download_and_prep_template/blob/master/icdGroups.json">example</a>).</p></li>
<li><p>An existing dataset <code class="code docutils literal notranslate"><span class="pre">input.csv</span></code> (such as <code class="code docutils literal notranslate"><span class="pre">outputFilename.csv</span></code> from the last section).</p></li>
<li><p>If you want to define prevalent and incident disease, <code class="code docutils literal notranslate"><span class="pre">input.csv</span></code> should also contain a date column which will be used to define this.</p></li>
</ul>
<p>Then run:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python addNewHES.py input.csv hesin_all.csv output.csv icdGroups.json --incident_prevalent True --date_column <span class="s1">&#39;name_of_date_column&#39;</span>
</pre></div>
</div>
<p>This will add a column containing the date of first instance of the given disease definition, as well as a binary column indicating incident disease and a binary column indicating prevalent disease (relative to the date in the specified date column).</p>
<div class="section" id="notes">
<h3>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The JSON file should have <code class="code docutils literal notranslate"><span class="pre">level</span></code> specified. <code class="code docutils literal notranslate"><span class="pre">&quot;level&quot;:</span> <span class="pre">&quot;primary&quot;</span></code> identifies only diagnoses which were the primary diagnosis in the admission, whereas <code class="code docutils literal notranslate"><span class="pre">&quot;level&quot;:</span> <span class="pre">&quot;all&quot;</span></code> identifies all diagnoses.</p></li>
<li><p>This dataset includes hospital admissions only. You may also want to extract appearance of these codes on death certificates, which are available in the download of participant data (fields <a class="reference external" href="https://biobank.ctsu.ox.ac.uk/crystal/label.cgi?id=100093">40001 and 40002</a> or <a class="reference external" href="https://biobank.ctsu.ox.ac.uk/crystal/exinfo.cgi?src=COVID19_availability">via the Data Portal</a>) .</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="advanced.html" class="btn btn-neutral float-right" title="Advanced usage" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="started.html" class="btn btn-neutral float-left" title="Getting started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Rosemary Walmsley, Shing Chan, Aiden Doherty

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>